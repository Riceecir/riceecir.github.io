(this.webpackJsonpjira=this.webpackJsonpjira||[]).push([[10],{424:function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"d",(function(){return b})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return j})),n.d(t,"g",(function(){return l})),n.d(t,"f",(function(){return O})),n.d(t,"e",(function(){return f}));var r=n(29),c=n(426),a=n(425),i=n(0),d=n(20),o=n(154),u=function(){var e,t=null===(e=Object(d.g)().pathname.match(/projects\/(\d+)/))||void 0===e?void 0:e[1];return Number(t)},b=function(){return Object(c.d)(u())},s=function(){return{projectId:u()}},j=function(){return["boards",s()]},l=function(){var e=Object(o.f)(["name","typeId","processorId","tagId"]),t=Object(r.a)(e,1)[0],n=u();return Object(i.useMemo)((function(){return{projectId:n,name:t.name,typeId:Number(t.typeId)||void 0,processorId:Number(t.processorId)||void 0,tagId:Number(t.tagId)||void 0}}),[n,t])},O=function(){return["tasks",l()]},f=function(){var e=Object(o.f)(["editingTaskId"]),t=Object(r.a)(e,2),n=t[0].editingTaskId,c=t[1],d=Object(a.e)(Number(n)),u=d.data,b=d.isLoading,s=Object(i.useCallback)((function(e){c({editingTaskId:e})}),[c]);return{editingTaskId:n,editingTask:u,isLoading:b,close:Object(i.useCallback)((function(){c({editingTaskId:""})}),[c]),edit:s}}},425:function(e,t,n){"use strict";n.d(t,"g",(function(){return u})),n.d(t,"e",(function(){return b})),n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return j})),n.d(t,"b",(function(){return l})),n.d(t,"f",(function(){return O})),n.d(t,"d",(function(){return f}));var r=n(35),c=n(174),a=n(100),i=n(175),d=n(154),o=n(428),u=function(e){var t=Object(c.b)(),n=Object(i.a)(Object(r.a)(Object(r.a)({},e),{},{name:Object(d.b)(null===e||void 0===e?void 0:e.name,200)}));return Object(a.useQuery)(["tasks",n],(function(){return t("tasks",{data:n})}))},b=function(e){var t=Object(c.b)();return Object(a.useQuery)(["tasks",{id:e}],(function(){return t("tasks/".concat(e))}),{enabled:!!e})},s=function(e){var t=Object(c.b)();return Object(a.useMutation)((function(e){return t("tasks",{data:e,method:"POST"})}),Object(o.a)(e))},j=function(e){var t=Object(c.b)();return Object(a.useMutation)((function(e){return t("tasks/".concat(e.id),{data:e,method:"PATCH"})}),Object(o.c)(e))},l=function(e){var t=Object(c.b)();return Object(a.useMutation)((function(e){var n=e.id;return t("tasks/".concat(n),{method:"DELETE"})}),Object(o.b)(e))},O=function(){var e=Object(c.b)();return Object(a.useQuery)(["taskTypes"],(function(){return e("taskTypes")}))},f=function(e){var t=Object(c.b)();return Object(a.useMutation)((function(e){return t("tasks/reorder",{data:e,method:"POST"})}),Object(o.e)(e))}},445:function(e,t,n){"use strict";n.r(t);var r,c,a,i=n(98),d=n(0),o=n.n(d),u=n(99),b=n(174),s=n(100),j=n(175),l=n(428),O=function(e){var t=Object(b.b)();return Object(s.useQuery)(["boards",Object(j.a)(e)],(function(){return t("kanbans",{data:e})}))},f=n(97),v=n(154),p=n(35),m=n(114),x=n(425),h=n(424),g=n.p+"static/media/bug.bc7dca9d.svg",k=n.p+"static/media/task.8118694e.svg",I=n(429),y=n(447),T=n(454),w=n(437),C=n(155),E=n(438),N=n(18),L=n.n(N),M=n(46),P=n(29),R=n(421),S=n(24),F=function(e){var t=e.kanbanId,n=Object(d.useState)(""),r=Object(P.a)(n,2),c=r[0],a=r[1],i=Object(x.a)(Object(h.f)()).mutateAsync,o=Object(h.c)(),u=Object(d.useState)(!1),b=Object(P.a)(u,2),s=b[0],j=b[1],l=function(){var e=Object(M.a)(L.a.mark((function e(){return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({projectId:o,name:c,kanbanId:t});case 2:j(!1),a("");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){return j((function(e){return!e}))};return s?Object(S.jsx)(y.a,{children:Object(S.jsx)(R.a,{value:c,placeholder:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d\u79f0",autoFocus:!0,onBlur:O,onPressEnter:l,onChange:function(e){return a(e.target.value)}})}):Object(S.jsx)(C.a,{type:"link",onClick:O,children:"+\u521b\u5efa\u4efb\u52a1"})},A=function(e){var t=e.str,n=e.keyword;if(!n)return Object(S.jsx)(S.Fragment,{children:t});var r=t.split(n);return Object(S.jsx)(S.Fragment,{children:r.map((function(e,t){return Object(S.jsxs)("span",{children:[e,t!==r.length-1&&Object(S.jsx)("span",{style:{color:"red"},children:n})]},t)}))})},V=n(436),Q=["children"],B=["children"],D=["children"],H=function(e){var t=e.children,n=Object(m.a)(e,Q);return Object(S.jsx)(V.c,Object(p.a)(Object(p.a)({},n),{},{children:function(e){return o.a.isValidElement(t)?o.a.cloneElement(t,Object(p.a)(Object(p.a)({},e.droppableProps),{},{ref:e.innerRef,provided:e})):Object(S.jsx)("div",{})}}))},J=o.a.forwardRef((function(e,t){var n,r=e.children,c=Object(m.a)(e,B);return Object(S.jsxs)("div",Object(p.a)(Object(p.a)({ref:t},c),{},{children:[r,null===(n=c.provided)||void 0===n?void 0:n.placeholder]}))})),K=function(e){var t=e.children,n=Object(m.a)(e,D);return Object(S.jsx)(V.b,Object(p.a)(Object(p.a)({},n),{},{children:function(e){return o.a.isValidElement(t)?o.a.cloneElement(t,Object(p.a)(Object(p.a)(Object(p.a)({},e.dragHandleProps),e.draggableProps),{},{ref:e.innerRef})):Object(S.jsx)("div",{})}}))},U=["board"],W=function(e){var t,n=e.id,r=Object(x.f)().data,c=null===r||void 0===r||null===(t=r.find((function(e){return e.id===n})))||void 0===t?void 0:t.name;return c?Object(S.jsx)("img",{src:"task"===c?g:k,alt:""}):null},q=o.a.forwardRef((function(e,t){var n=e.board,r=Object(m.a)(e,U),c=Object(x.g)(Object(h.g)()).data,a=null===c||void 0===c?void 0:c.filter((function(e){return e.kanbanId===n.id}));return Object(S.jsxs)(X,Object(p.a)(Object(p.a)({ref:t},r),{},{children:[Object(S.jsxs)(I.a,{align:"middle",justify:"space-between",children:[Object(S.jsx)("h3",{children:n.name}),Object(S.jsx)(G,{board:n})]}),Object(S.jsxs)(Y,{children:[Object(S.jsx)(H,{type:"ROW",direction:"vertical",droppableId:String(n.id),children:Object(S.jsx)(J,{style:{minHeight:".5rem"},children:null===a||void 0===a?void 0:a.map((function(e,t){return Object(S.jsx)(K,{draggableId:"task"+e.id,index:t,children:Object(S.jsx)("div",{children:Object(S.jsx)(z,{task:e},e.id)})},e.id)}))})}),Object(S.jsx)(F,{kanbanId:n.id})]})]}))})),z=function(e){var t=e.task,n=Object(h.e)().edit,r=Object(h.g)().name;return Object(S.jsx)(y.a,{style:{marginBottom:".5rem",cursor:"pointer"},onClick:function(){return n(t.id)},children:Object(S.jsxs)(I.a,{align:"middle",children:[Object(S.jsx)(A,{str:t.name,keyword:r}),Object(S.jsx)(W,{id:t.typeId})]})},t.id)},G=function(e){var t=e.board,n=function(e){var t=Object(b.b)();return Object(s.useMutation)((function(e){var n=e.id;return t("kanbans/".concat(n),{method:"DELETE"})}),Object(l.b)(e))}(Object(h.a)()).mutateAsync,r=Object(S.jsx)(w.a,{children:Object(S.jsx)(w.a.Item,{children:Object(S.jsx)(C.a,{type:"link",danger:!0,onClick:function(){T.a.confirm({okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664".concat(t.name,"\u770b\u677f\u5417?"),onOk:function(){return n({id:t.id})}})},children:"\u5220\u9664"})},"delete")});return Object(S.jsx)(E.a,{overlay:r,children:Object(S.jsx)(C.a,{type:"link",children:"..."})})},X=u.a.div(r||(r=Object(i.a)(["\n  display: flex;\n  flex-direction: column;\n  min-width: 27rem;\n  border-radius: 4px;\n  background-color: rgb(246, 245, 245);\n  padding: 0.6rem 0.6rem 1rem;\n  margin-right: 0.5rem;\n"]))),Y=u.a.div(c||(c=Object(i.a)(["\n  overflow: auto;\n  flex: 1;\n  ::-webkit-scrollbar {\n    display: none;\n  }\n"]))),Z=n(431),$=n(427),_=function(){var e=Object($.a)().data,t=Object(x.f)().data,n=Object(h.g)(),r=Object(v.e)();return Object(S.jsxs)(f.e,{marginBottom:2,gap:!0,children:[Object(S.jsx)(R.a,{style:{width:"20rem"},placeholder:"\u4efb\u52a1\u540d",value:n.name,onChange:function(e){return r({name:e.target.value})}}),Object(S.jsx)(Z.a,{defaultOptionName:"\u7ecf\u529e\u4eba",value:n.processorId,options:e||[],onChange:function(e){return r({processorId:e})}}),Object(S.jsx)(Z.a,{defaultOptionName:"\u7c7b\u578b",value:n.typeId,options:t||[],onChange:function(e){return r({typeId:e})}}),Object(S.jsx)(C.a,{onClick:function(){r({typeId:void 0,processorId:void 0,tagId:void 0,name:void 0})},children:"\u91cd\u7f6e"})]})},ee=o.a.forwardRef((function(e,t){var n=Object(d.useState)(""),r=Object(P.a)(n,2),c=r[0],a=r[1],i=Object(h.c)(),o=function(e){var t=Object(b.b)();return Object(s.useMutation)((function(e){return t("kanbans",{data:e,method:"POST"})}),Object(l.a)(e))}(Object(h.a)()).mutateAsync,u=function(){var e=Object(M.a)(L.a.mark((function e(){return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o({name:c,projectId:i});case 2:a("");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(S.jsx)(X,{ref:t,children:Object(S.jsx)(R.a,{value:c,placeholder:"\u65b0\u5efa\u770b\u677f\u540d\u79f0",onPressEnter:u,onChange:function(e){return a(e.target.value)}})})})),te=n(420),ne={labelCol:{span:5},wrapperCol:{span:18}},re=function(){var e=Object($.a)().data,t=Object(x.f)().data,n=te.a.useForm(),r=Object(P.a)(n,1)[0],c=Object(h.e)(),a=c.editingTask,i=c.editingTaskId,o=c.close,u=Object(x.c)(Object(h.f)()),b=u.mutateAsync,s=u.isLoading,j=Object(x.b)(Object(h.f)()).mutateAsync,l=function(){var e=Object(M.a)(L.a.mark((function e(){return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b(Object(p.a)(Object(p.a)({},a),r.getFieldsValue()));case 2:o();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(d.useEffect)((function(){r.setFieldsValue(a)}),[r,a]),Object(S.jsx)(T.a,{visible:!!i,title:"\u7f16\u8f91\u4efb\u52a1",forceRender:!0,okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",confirmLoading:s,onCancel:function(){o(),r.resetFields()},onOk:l,children:Object(S.jsxs)(te.a,Object(p.a)(Object(p.a)({initialValues:a,form:r},ne),{},{children:[Object(S.jsx)(te.a.Item,{label:"\u4efb\u52a1\u540d",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d"}],children:Object(S.jsx)(R.a,{})}),Object(S.jsx)(te.a.Item,{label:"\u7ecf\u529e\u4eba",name:"processorId",children:Object(S.jsx)(Z.a,{defaultOptionName:"\u7ecf\u529e\u4eba",options:e||[]})}),Object(S.jsx)(te.a.Item,{label:"\u7c7b\u578b",name:"typeId",children:Object(S.jsx)(Z.a,{defaultOptionName:"\u7c7b\u578b",options:t||[]})}),Object(S.jsx)(I.a,{justify:"end",align:"middle",children:Object(S.jsx)(C.a,{type:"link",danger:!0,onClick:function(){T.a.confirm({okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u4efb\u52a1\u5417?",onOk:function(){return j({id:Number(i)}).then(o)}})},children:"\u5220\u9664"})})]}))})},ce=(t.default=function(){Object(v.c)("\u770b\u677f\u5217\u8868");var e=Object(h.d)().data,t=O(Object(h.b)()),n=t.data,r=t.isLoading,c=Object(x.g)(Object(h.g)()).isLoading,a=r||c,i=ce();return Object(S.jsx)(f.f,{children:Object(S.jsxs)(V.a,{onDragEnd:i,children:[Object(S.jsxs)("h1",{children:[null===e||void 0===e?void 0:e.name,"\u770b\u677f"]}),Object(S.jsx)(_,{}),a?Object(S.jsx)(f.d,{}):Object(S.jsxs)(ae,{children:[Object(S.jsx)(H,{type:"COLUMN",direction:"horizontal",droppableId:"board",children:Object(S.jsx)(J,{style:{display:"flex"},children:null===n||void 0===n?void 0:n.map((function(e,t){return Object(S.jsx)(K,{draggableId:"board"+e.id,index:t,children:Object(S.jsx)(q,{board:e},e.id)},e.id)}))})}),Object(S.jsx)(ee,{})]}),Object(S.jsx)(re,{})]})})},function(){var e=O(Object(h.b)()).data,t=Object(x.g)(Object(h.g)()).data,n=void 0===t?[]:t,r=function(e){var t=Object(b.b)();return Object(s.useMutation)((function(e){return t("kanbans/reorder",{data:e,method:"POST"})}),Object(l.d)(e))}(Object(h.a)()).mutate,c=Object(x.d)(Object(h.f)()).mutate;return Object(d.useCallback)((function(t){var a=t.source,i=t.destination,d=t.type;if(console.log({source:a,destination:i,type:d}),i){if("COLUMN"===d){var o=null===e||void 0===e?void 0:e[a.index].id,u=null===e||void 0===e?void 0:e[i.index].id;if(!o||!u||o===u)return;var b=i.index>a.index?"after":"before";r({fromId:o,referenceId:u,type:b})}if("ROW"===d){var s=+a.droppableId,j=+i.droppableId,l=null===n||void 0===n?void 0:n.filter((function(e){return e.kanbanId===s}))[a.index],O=null===n||void 0===n?void 0:n.filter((function(e){return e.kanbanId===j}))[i.index];if((null===l||void 0===l?void 0:l.id)===(null===O||void 0===O?void 0:O.id))return;var f=s===j&&i.index>a.index?"after":"before";c({fromId:null===l||void 0===l?void 0:l.id,referenceId:null===O||void 0===O?void 0:O.id,fromKanbanId:Number(s),toKanbanId:Number(j),type:f})}}}),[e,n,r,c])}),ae=u.a.div(a||(a=Object(i.a)(["\n  flex: 1;\n  display: flex;\n  overflow: auto;\n  margin-right: 2rem;\n"])))}}]);
//# sourceMappingURL=10.43a20ea9.chunk.js.map