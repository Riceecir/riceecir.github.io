{"version":3,"sources":["components/pin.tsx","screens/project-list/list.tsx","screens/project-list/search-panel.tsx","screens/project-list/index.tsx"],"names":["Pin","props","checked","onCheckedChange","resetProps","count","value","onChange","num","List","users","refresh","mutate","useEditProject","useProjectsQueryKey","pagination","columns","title","disabled","render","project","pin","id","pinProject","key","sorter","a","b","name","localeCompare","to","dataIndex","find","user","personId","created","dayjs","format","More","edit","useProjectModal","deleteProject","useDeleteProject","overlay","Item","type","onClick","danger","Modal","confirm","okText","cancelText","onOk","SearchPanel","param","setParam","style","marginBottom","layout","e","target","defaultOptionName","options","ProjectList","useDocumentTitle","useUser","data","useProjectsSearchParams","open","useProjects","useDebounce","isLoading","error","list","justify","loading","dataSource"],"mappings":"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","file":"static/js/11.9d741b40.chunk.js","sourcesContent":["import React from \"react\";\nimport { Rate } from \"antd\";\n\ninterface PinProps extends React.ComponentProps<typeof Rate> {\n  checked: boolean;\n  onCheckedChange?: (checked: boolean) => void;\n}\n\nexport const Pin = (props: PinProps) => {\n  const { checked, onCheckedChange, ...resetProps } = props;\n\n  return (\n    <Rate\n      count={1}\n      value={checked ? 1 : 0}\n      onChange={(num) => onCheckedChange && onCheckedChange(!!num)}\n      {...resetProps}\n    />\n  );\n};\n","import React from \"react\";\nimport { Button, Dropdown, Menu, Table, TableProps, Modal } from \"antd\";\nimport { User } from \"types/user\";\nimport dayjs from \"dayjs\";\nimport { Link } from \"react-router-dom\";\nimport { Pin } from \"components/pin\";\nimport { useDeleteProject, useEditProject } from \"api/project\";\nimport { ButtonNoPadding } from \"components/lib\";\nimport { useProjectModal } from \"utils/project\";\nimport { useProjectsQueryKey } from \"./utils\";\nimport { Project } from \"types/project\";\n\ninterface ListProps extends TableProps<Project> {\n  users: User[];\n  refresh?: () => void;\n}\n\nexport const List = ({ users, refresh, ...props }: ListProps) => {\n  const { mutate } = useEditProject(useProjectsQueryKey());\n  const pinProject = (id: number, pin: boolean) => mutate({ id, pin });\n\n  return (\n    <Table\n      pagination={false}\n      columns={[\n        {\n          title: <Pin checked={true} disabled={true} />,\n          render(value, project) {\n            return (\n              <Pin\n                checked={project.pin}\n                onCheckedChange={(pin) => pinProject(project.id, pin)}\n              />\n            );\n          },\n        },\n        {\n          title: \"名称\",\n          key: \"name\",\n          sorter: (a, b) => a.name.localeCompare(b.name),\n          render(value, project) {\n            return <Link to={`${project.id}`}>{project.name}</Link>;\n          },\n        },\n        {\n          title: \"部门\",\n          key: \"organization\",\n          dataIndex: \"organization\",\n        },\n        {\n          title: \"负责人\",\n          key: \"personId\",\n          render(value, project) {\n            return (\n              <span>\n                {users.find((user) => user.id === project.personId)?.name ||\n                  \"未知\"}\n              </span>\n            );\n          },\n        },\n        {\n          title: \"创建时间\",\n          key: \"created\",\n          render(value, project) {\n            return (\n              <span>\n                {project.created\n                  ? dayjs(project.created).format(\"YYYY-MM-DD\")\n                  : \"无\"}\n              </span>\n            );\n          },\n        },\n        {\n          render(value, project) {\n            return <More project={project} />;\n          },\n        },\n      ]}\n      {...props}\n    />\n  );\n};\n\n/* 更多操作 */\nconst More = ({ project }: { project: Project }) => {\n  const { edit } = useProjectModal();\n  const { mutate: deleteProject } = useDeleteProject(useProjectsQueryKey());\n  const editProject = (id: number) => edit(id);\n\n  const confirmDelete = (id: number) => {\n    Modal.confirm({\n      title: `确认删除\"${project.name}\"这个项目吗?`,\n      okText: \"确认\",\n      cancelText: \"取消\",\n      onOk() {\n        deleteProject({ id });\n      },\n    });\n  };\n\n  return (\n    <Dropdown\n      overlay={\n        <Menu>\n          <Menu.Item key={\"edit\"}>\n            <Button type={\"link\"} onClick={() => editProject(project.id)}>\n              编辑\n            </Button>\n          </Menu.Item>\n          <Menu.Item key={\"delete\"}>\n            <Button\n              type={\"link\"}\n              danger\n              onClick={() => confirmDelete(project.id)}\n            >\n              删除\n            </Button>\n          </Menu.Item>\n        </Menu>\n      }\n    >\n      <ButtonNoPadding type={\"link\"}>...</ButtonNoPadding>\n    </Dropdown>\n  );\n};\n","import React from \"react\";\nimport { Form, Input } from \"antd\";\nimport { IdSelect } from \"components/id-select\";\nimport { User } from \"types/user\";\nimport { Project } from \"types/project\";\n\ninterface SearchPanelProps {\n  users: User[];\n  param: Partial<Pick<Project, \"name\" | \"personId\">>;\n  setParam: (param: SearchPanelProps[\"param\"]) => void;\n}\n\nexport const SearchPanel = ({ param, setParam, users }: SearchPanelProps) => {\n  return (\n    <Form style={{ marginBottom: \"2rem\" }} layout=\"inline\">\n      <Form.Item>\n        <Input\n          type=\"text\"\n          value={param.name}\n          onChange={(e) =>\n            setParam({\n              ...param,\n              name: e.target.value,\n            })\n          }\n        />\n      </Form.Item>\n\n      <Form.Item>\n        <IdSelect\n          defaultOptionName={\"负责人\"}\n          options={users || []}\n          value={param.personId}\n          onChange={(value) =>\n            setParam({\n              ...param,\n              personId: value,\n            })\n          }\n        />\n      </Form.Item>\n    </Form>\n  );\n};\n","import React from \"react\";\nimport { List } from \"./list\";\nimport { SearchPanel } from \"./search-panel\";\nimport { useDebounce, useDocumentTitle } from \"../../utils/custom-hook\";\nimport styled from \"@emotion/styled\";\nimport { useProjects } from \"api/project\";\nimport { Button, Row } from \"antd\";\nimport { useUser } from \"api/user\";\nimport { useProjectsSearchParams } from \"./utils\";\nimport { useProjectModal } from \"utils/project\";\nimport { ErrorBox, ScreenContainer } from \"components/lib\";\n\nconst ProjectList = () => {\n  useDocumentTitle(\"项目列表\");\n  const { data: users } = useUser();\n  const [param, setParam] = useProjectsSearchParams();\n  const { open } = useProjectModal();\n\n  const {\n    isLoading,\n    error,\n    data: list,\n    // retry,\n  } = useProjects(useDebounce(param, 300));\n\n  return (\n    <ScreenContainer>\n      <Row justify={\"space-between\"}>\n        <h1>项目列表</h1>\n        <Button onClick={open}>创建项目</Button>\n      </Row>\n      <SearchPanel param={param} setParam={setParam} users={users || []} />\n      <ErrorBox error={error} />\n      <List\n        // refresh={retry}\n        loading={isLoading}\n        dataSource={list || []}\n        users={users || []}\n      />\n    </ScreenContainer>\n  );\n};\n\nexport default ProjectList;\n"],"sourceRoot":""}