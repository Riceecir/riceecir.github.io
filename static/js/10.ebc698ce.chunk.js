(this.webpackJsonpjira=this.webpackJsonpjira||[]).push([[10],{395:function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"d",(function(){return b})),n.d(t,"b",(function(){return j})),n.d(t,"a",(function(){return s})),n.d(t,"g",(function(){return l})),n.d(t,"f",(function(){return O})),n.d(t,"e",(function(){return f}));var r=n(28),c=n(397),a=n(396),i=n(0),d=n(20),o=n(144),u=function(){var e,t=null===(e=Object(d.g)().pathname.match(/projects\/(\d+)/))||void 0===e?void 0:e[1];return Number(t)},b=function(){return Object(c.d)(u())},j=function(){return{projectId:u()}},s=function(){return["boards",j()]},l=function(){var e=Object(o.f)(["name","typeId","processorId","tagId"]),t=Object(r.a)(e,1)[0],n=u();return Object(i.useMemo)((function(){return{projectId:n,name:t.name,typeId:Number(t.typeId)||void 0,processorId:Number(t.processorId)||void 0,tagId:Number(t.tagId)||void 0}}),[n,t])},O=function(){return["tasks",l()]},f=function(){var e=Object(o.f)(["editingTaskId"]),t=Object(r.a)(e,2),n=t[0].editingTaskId,c=t[1],d=Object(a.e)(Number(n)),u=d.data,b=d.isLoading,j=Object(i.useCallback)((function(e){c({editingTaskId:e})}),[c]);return{editingTaskId:n,editingTask:u,isLoading:b,close:Object(i.useCallback)((function(){c({editingTaskId:""})}),[c]),edit:j}}},396:function(e,t,n){"use strict";n.d(t,"g",(function(){return b})),n.d(t,"e",(function(){return j})),n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return l})),n.d(t,"b",(function(){return O})),n.d(t,"f",(function(){return f})),n.d(t,"d",(function(){return v}));var r=n(35),c=n(164),a=n(431),i=n(433),d=n(163),o=n(144),u=n(399),b=function(e){var t=Object(c.b)(),n=Object(d.a)(Object(r.a)(Object(r.a)({},e),{},{name:Object(o.b)(null===e||void 0===e?void 0:e.name,200)}));return Object(a.a)(["tasks",n],(function(){return t("tasks",{data:n})}))},j=function(e){var t=Object(c.b)();return Object(a.a)(["tasks",{id:e}],(function(){return t("tasks/".concat(e))}),{enabled:!!e})},s=function(e){var t=Object(c.b)();return Object(i.a)((function(e){return t("tasks",{data:e,method:"POST"})}),Object(u.a)(e))},l=function(e){var t=Object(c.b)();return Object(i.a)((function(e){return t("tasks/".concat(e.id),{data:e,method:"PATCH"})}),Object(u.c)(e))},O=function(e){var t=Object(c.b)();return Object(i.a)((function(e){var n=e.id;return t("tasks/".concat(n),{method:"DELETE"})}),Object(u.b)(e))},f=function(){var e=Object(c.b)();return Object(a.a)(["taskTypes"],(function(){return e("taskTypes")}))},v=function(e){var t=Object(c.b)();return Object(i.a)((function(e){return t("tasks/reorder",{data:e,method:"POST"})}),Object(u.e)(e))}},416:function(e,t,n){"use strict";n.r(t);var r,c,a,i=n(96),d=n(0),o=n.n(d),u=n(97),b=n(164),j=n(431),s=n(433),l=n(163),O=n(399),f=function(e){var t=Object(b.b)();return Object(j.a)(["boards",Object(l.a)(e)],(function(){return t("kanbans",{data:e})}))},v=n(95),p=n(144),m=n(35),x=n(107),h=n(396),g=n(395),k=n.p+"static/media/bug.bc7dca9d.svg",I=n.p+"static/media/task.8118694e.svg",y=n(400),T=n(418),w=n(426),C=n(408),E=n(146),N=n(409),L=n(18),P=n.n(L),R=n(45),S=n(28),F=n(391),A=n(24),V=function(e){var t=e.kanbanId,n=Object(d.useState)(""),r=Object(S.a)(n,2),c=r[0],a=r[1],i=Object(h.a)(Object(g.f)()).mutateAsync,o=Object(g.c)(),u=Object(d.useState)(!1),b=Object(S.a)(u,2),j=b[0],s=b[1],l=function(){var e=Object(R.a)(P.a.mark((function e(){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({projectId:o,name:c,kanbanId:t});case 2:s(!1),a("");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){return s((function(e){return!e}))};return j?Object(A.jsx)(T.a,{children:Object(A.jsx)(F.a,{value:c,placeholder:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d\u79f0",autoFocus:!0,onBlur:O,onPressEnter:l,onChange:function(e){return a(e.target.value)}})}):Object(A.jsx)(E.a,{type:"link",onClick:O,children:"+\u521b\u5efa\u4efb\u52a1"})},B=function(e){var t=e.str,n=e.keyword;if(!n)return Object(A.jsx)(A.Fragment,{children:t});var r=t.split(n);return Object(A.jsx)(A.Fragment,{children:r.map((function(e,t){return Object(A.jsxs)("span",{children:[e,t!==r.length-1&&Object(A.jsx)("span",{style:{color:"red"},children:n})]},t)}))})},D=n(407),H=function(e){var t=e.children,n=Object(x.a)(e,["children"]);return Object(A.jsx)(D.c,Object(m.a)(Object(m.a)({},n),{},{children:function(e){return o.a.isValidElement(t)?o.a.cloneElement(t,Object(m.a)(Object(m.a)({},e.droppableProps),{},{ref:e.innerRef,provided:e})):Object(A.jsx)("div",{})}}))},M=o.a.forwardRef((function(e,t){var n,r=e.children,c=Object(x.a)(e,["children"]);return Object(A.jsxs)("div",Object(m.a)(Object(m.a)({ref:t},c),{},{children:[r,null===(n=c.provided)||void 0===n?void 0:n.placeholder]}))})),J=function(e){var t=e.children,n=Object(x.a)(e,["children"]);return Object(A.jsx)(D.b,Object(m.a)(Object(m.a)({},n),{},{children:function(e){return o.a.isValidElement(t)?o.a.cloneElement(t,Object(m.a)(Object(m.a)(Object(m.a)({},e.dragHandleProps),e.draggableProps),{},{ref:e.innerRef})):Object(A.jsx)("div",{})}}))},K=function(e){var t,n=e.id,r=Object(h.f)().data,c=null===r||void 0===r||null===(t=r.find((function(e){return e.id===n})))||void 0===t?void 0:t.name;return c?Object(A.jsx)("img",{src:"task"===c?k:I,alt:""}):null},U=o.a.forwardRef((function(e,t){var n=e.board,r=Object(x.a)(e,["board"]),c=Object(h.g)(Object(g.g)()).data,a=null===c||void 0===c?void 0:c.filter((function(e){return e.kanbanId===n.id}));return Object(A.jsxs)(z,Object(m.a)(Object(m.a)({ref:t},r),{},{children:[Object(A.jsxs)(y.a,{align:"middle",justify:"space-between",children:[Object(A.jsx)("h3",{children:n.name}),Object(A.jsx)(q,{board:n})]}),Object(A.jsxs)(G,{children:[Object(A.jsx)(H,{type:"ROW",direction:"vertical",droppableId:String(n.id),children:Object(A.jsx)(M,{style:{minHeight:".5rem"},children:null===a||void 0===a?void 0:a.map((function(e,t){return Object(A.jsx)(J,{draggableId:"task"+e.id,index:t,children:Object(A.jsx)("div",{children:Object(A.jsx)(W,{task:e},e.id)})},e.id)}))})}),Object(A.jsx)(V,{kanbanId:n.id})]})]}))})),W=function(e){var t=e.task,n=Object(g.e)().edit,r=Object(g.g)().name;return Object(A.jsx)(T.a,{style:{marginBottom:".5rem",cursor:"pointer"},onClick:function(){return n(t.id)},children:Object(A.jsxs)(y.a,{align:"middle",children:[Object(A.jsx)(B,{str:t.name,keyword:r}),Object(A.jsx)(K,{id:t.typeId})]})},t.id)},q=function(e){var t=e.board,n=function(e){var t=Object(b.b)();return Object(s.a)((function(e){var n=e.id;return t("kanbans/".concat(n),{method:"DELETE"})}),Object(O.b)(e))}(Object(g.a)()).mutateAsync,r=Object(A.jsx)(C.a,{children:Object(A.jsx)(C.a.Item,{children:Object(A.jsx)(E.a,{type:"link",danger:!0,onClick:function(){w.a.confirm({okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664".concat(t.name,"\u770b\u677f\u5417?"),onOk:function(){return n({id:t.id})}})},children:"\u5220\u9664"})},"delete")});return Object(A.jsx)(N.a,{overlay:r,children:Object(A.jsx)(E.a,{type:"link",children:"..."})})},z=u.a.div(r||(r=Object(i.a)(["\n  display: flex;\n  flex-direction: column;\n  min-width: 27rem;\n  border-radius: 4px;\n  background-color: rgb(246, 245, 245);\n  padding: 0.6rem 0.6rem 1rem;\n  margin-right: 0.5rem;\n"]))),G=u.a.div(c||(c=Object(i.a)(["\n  overflow: auto;\n  flex: 1;\n  ::-webkit-scrollbar {\n    display: none;\n  }\n"]))),Q=n(402),X=n(398),Y=function(){var e=Object(X.a)().data,t=Object(h.f)().data,n=Object(g.g)(),r=Object(p.e)();return Object(A.jsxs)(v.e,{marginBottom:2,gap:!0,children:[Object(A.jsx)(F.a,{style:{width:"20rem"},placeholder:"\u4efb\u52a1\u540d",value:n.name,onChange:function(e){return r({name:e.target.value})}}),Object(A.jsx)(Q.a,{defaultOptionName:"\u7ecf\u529e\u4eba",value:n.processorId,options:e||[],onChange:function(e){return r({processorId:e})}}),Object(A.jsx)(Q.a,{defaultOptionName:"\u7c7b\u578b",value:n.typeId,options:t||[],onChange:function(e){return r({typeId:e})}}),Object(A.jsx)(E.a,{onClick:function(){r({typeId:void 0,processorId:void 0,tagId:void 0,name:void 0})},children:"\u91cd\u7f6e"})]})},Z=o.a.forwardRef((function(e,t){var n=Object(d.useState)(""),r=Object(S.a)(n,2),c=r[0],a=r[1],i=Object(g.c)(),o=function(e){var t=Object(b.b)();return Object(s.a)((function(e){return t("kanbans",{data:e,method:"POST"})}),Object(O.a)(e))}(Object(g.a)()).mutateAsync,u=function(){var e=Object(R.a)(P.a.mark((function e(){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o({name:c,projectId:i});case 2:a("");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(A.jsx)(z,{ref:t,children:Object(A.jsx)(F.a,{value:c,placeholder:"\u65b0\u5efa\u770b\u677f\u540d\u79f0",onPressEnter:u,onChange:function(e){return a(e.target.value)}})})})),$=n(390),_={labelCol:{span:5},wrapperCol:{span:18}},ee=function(){var e=Object(X.a)().data,t=Object(h.f)().data,n=$.a.useForm(),r=Object(S.a)(n,1)[0],c=Object(g.e)(),a=c.editingTask,i=c.editingTaskId,o=c.close,u=Object(h.c)(Object(g.f)()),b=u.mutateAsync,j=u.isLoading,s=Object(h.b)(Object(g.f)()).mutateAsync,l=function(){var e=Object(R.a)(P.a.mark((function e(){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b(Object(m.a)(Object(m.a)({},a),r.getFieldsValue()));case 2:o();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(d.useEffect)((function(){r.setFieldsValue(a)}),[r,a]),Object(A.jsx)(w.a,{visible:!!i,title:"\u7f16\u8f91\u4efb\u52a1",forceRender:!0,okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",confirmLoading:j,onCancel:function(){o(),r.resetFields()},onOk:l,children:Object(A.jsxs)($.a,Object(m.a)(Object(m.a)({initialValues:a,form:r},_),{},{children:[Object(A.jsx)($.a.Item,{label:"\u4efb\u52a1\u540d",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d"}],children:Object(A.jsx)(F.a,{})}),Object(A.jsx)($.a.Item,{label:"\u7ecf\u529e\u4eba",name:"processorId",children:Object(A.jsx)(Q.a,{defaultOptionName:"\u7ecf\u529e\u4eba",options:e||[]})}),Object(A.jsx)($.a.Item,{label:"\u7c7b\u578b",name:"typeId",children:Object(A.jsx)(Q.a,{defaultOptionName:"\u7c7b\u578b",options:t||[]})}),Object(A.jsx)(y.a,{justify:"end",align:"middle",children:Object(A.jsx)(E.a,{type:"link",danger:!0,onClick:function(){w.a.confirm({okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u4efb\u52a1\u5417?",onOk:function(){return s({id:Number(i)}).then(o)}})},children:"\u5220\u9664"})})]}))})},te=(t.default=function(){Object(p.c)("\u770b\u677f\u5217\u8868");var e=Object(g.d)().data,t=f(Object(g.b)()),n=t.data,r=t.isLoading,c=Object(h.g)(Object(g.g)()).isLoading,a=r||c,i=te();return Object(A.jsx)(v.f,{children:Object(A.jsxs)(D.a,{onDragEnd:i,children:[Object(A.jsxs)("h1",{children:[null===e||void 0===e?void 0:e.name,"\u770b\u677f"]}),Object(A.jsx)(Y,{}),a?Object(A.jsx)(v.d,{}):Object(A.jsxs)(ne,{children:[Object(A.jsx)(H,{type:"COLUMN",direction:"horizontal",droppableId:"board",children:Object(A.jsx)(M,{style:{display:"flex"},children:null===n||void 0===n?void 0:n.map((function(e,t){return Object(A.jsx)(J,{draggableId:"board"+e.id,index:t,children:Object(A.jsx)(U,{board:e},e.id)},e.id)}))})}),Object(A.jsx)(Z,{})]}),Object(A.jsx)(ee,{})]})})},function(){var e=f(Object(g.b)()).data,t=Object(h.g)(Object(g.g)()).data,n=void 0===t?[]:t,r=function(e){var t=Object(b.b)();return Object(s.a)((function(e){return t("kanbans/reorder",{data:e,method:"POST"})}),Object(O.d)(e))}(Object(g.a)()).mutate,c=Object(h.d)(Object(g.f)()).mutate;return Object(d.useCallback)((function(t){var a=t.source,i=t.destination,d=t.type;if(console.log({source:a,destination:i,type:d}),i){if("COLUMN"===d){var o=null===e||void 0===e?void 0:e[a.index].id,u=null===e||void 0===e?void 0:e[i.index].id;if(!o||!u||o===u)return;var b=i.index>a.index?"after":"before";r({fromId:o,referenceId:u,type:b})}if("ROW"===d){var j=+a.droppableId,s=+i.droppableId,l=null===n||void 0===n?void 0:n.filter((function(e){return e.kanbanId===j}))[a.index],O=null===n||void 0===n?void 0:n.filter((function(e){return e.kanbanId===s}))[i.index];if((null===l||void 0===l?void 0:l.id)===(null===O||void 0===O?void 0:O.id))return;var f=j===s&&i.index>a.index?"after":"before";c({fromId:null===l||void 0===l?void 0:l.id,referenceId:null===O||void 0===O?void 0:O.id,fromKanbanId:Number(j),toKanbanId:Number(s),type:f})}}}),[e,n,r,c])}),ne=u.a.div(a||(a=Object(i.a)(["\n  flex: 1;\n  display: flex;\n  overflow: auto;\n  margin-right: 2rem;\n"])))}}]);
//# sourceMappingURL=10.ebc698ce.chunk.js.map